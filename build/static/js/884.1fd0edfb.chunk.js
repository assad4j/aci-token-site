"use strict";(self.webpackChunkaci_presale_site=self.webpackChunkaci_presale_site||[]).push([[884],{40884:(e,t,r)=>{r.r(t),r.d(t,{default:()=>f});var s=r(9950),n=r(44414);const i={emotion:"\u2014",stress:.2,confidence:.6,wpm:null,fillersPerMin:null},l={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_WALLETCONNECT_PROJECT_ID:"TON_PROJECT_ID_ICI",REACT_APP_PRESALE_CONTRACT_ADDRESS:"0x8257194Ae124EDEA0E434a3D1479e52C5a5C59C4",REACT_APP_PRESALE_CHAIN_ID:"1",REACT_APP_PRESALE_MIN_ETH:"0.01",REACT_APP_PRESALE_MAX_ETH:"50",REACT_APP_PRESALE_STATS_ENDPOINT:"",REACT_APP_PRESALE_NETWORK_LABEL:"Ethereum Mainnet",REACT_APP_PRESALE_RPC_URL:"https://eth-mainnet.g.alchemy.com/v2/bkYap2FHqztpHzjU0deDu",REACT_APP_ANALYTICS_ID:"",REACT_APP_STAKING_CONTRACT_ADDRESS:"0xb151450F16Efef1F312D72E740Ca4b54698755cD",REACT_APP_STAKING_TOKEN_ADDRESS:"0x8257194Ae124EDEA0E434a3D1479e52C5a5C59C4",REACT_APP_STAKING_CHAIN_ID:"1",REACT_APP_STAKING_MIN_AMOUNT:"0",REACT_APP_STAKING_NETWORK_LABEL:"Ethereum Mainnet",REACT_APP_ACI_AI_URL:"http://localhost:3000/api/coach"}.REACT_APP_AUDIO_AI_URL,a=["euh","heu","uh","hum","hmm"],o={angry:"Col\xe8re",disgusted:"D\xe9go\xfbt",disgust:"D\xe9go\xfbt",fear:"Craintif",fearful:"Craintif",happy:"Joyeux",sad:"Triste",surprise:"Surpris",surprised:"Surpris",neutral:"Neutre",calm:"Calme",bored:"Distrait",sleepy:"Somnolent",serious:"S\xe9rieux",confused:"Perplexe",excited:"Enthousiaste",smile:"Sourire"};function c(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(!e)return null;const t=e.toLowerCase();return o[t]?o[t]:e.charAt(0).toUpperCase()+e.slice(1)}function u(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Math.min(r,Math.max(t,e))}function d(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.25;return null===e||Number.isNaN(e)?t:e*(1-r)+t*r}function m(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return!Number.isFinite(e)||e<0?"\u2014":Number(e).toFixed(t)}function p(e){const t=[];return e.stress>.65&&t.push("Pr\xe9pare un rituel de reset (respiration, ancrage) avant ta prochaine session."),e.confidence<.45&&t.push("\xc9cris ton intention en une phrase cl\xe9 et r\xe9p\xe8te-la \xe0 voix haute avant de d\xe9marrer."),e.fillers>4&&t.push("Pratique un silence conscient : marque une pause d\xe8s que tu sens venir un \u201ceuh\u201d."),e.wpm>110&&t.push("Travaille ton rythme : lis un passage lentement pour t\u2019habituer \xe0 ralentir."),e.confidence>.7&&e.stress<.55&&t.push("Challenge bonus : expose une id\xe9e complexe en 120 secondes lors de la prochaine s\xe9ance."),t.length<3&&t.push("R\xe9p\xe8te la structure \u201cSituation - Action - R\xe9sultat\u201d pour fluidifier ton discours."),t.length<3&&t.push("Installe-toi dans un environnement calme et v\xe9rifie ton mat\xe9riel audio \xe0 l\u2019avance."),t.length<3&&t.push("Hydrate-toi 10 minutes avant la session pour soutenir la qualit\xe9 de ta voix."),t.slice(0,3)}function h(e){let{history:t}=e;const r=(0,s.useMemo)(()=>{if(!t.length)return null;const e=t.length,r=r=>t.map((t,s)=>`${s/(e-1||1)*100},${100-100*t[r]}`).join(" ");return{stress:r("stress"),confidence:r("confidence")}},[t]);return r?(0,n.jsxs)("svg",{viewBox:"0 0 100 100",preserveAspectRatio:"none",className:"h-40 w-full rounded-2xl border border-white/10 bg-black/40 p-2 text-white",children:[(0,n.jsx)("polyline",{points:r.stress,fill:"none",stroke:"rgb(244, 63, 94)",strokeWidth:"2"}),(0,n.jsx)("polyline",{points:r.confidence,fill:"none",stroke:"rgb(16, 185, 129)",strokeWidth:"2"})]}):(0,n.jsx)("div",{className:"h-40 w-full rounded-2xl border border-white/10 bg-black/40 flex items-center justify-center text-white/60",children:"Aucune donn\xe9e disponible pour cette session."})}function x(e){let{label:t,value:r}=e;const s=100*u(r,0,1)+"%";return(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between text-sm uppercase text-white/60 tracking-wide",children:[(0,n.jsx)("span",{children:t}),(0,n.jsxs)("span",{children:[m(100*r,0),"%"]})]}),(0,n.jsx)("div",{className:"h-2 rounded-full bg-white/10",children:(0,n.jsx)("div",{className:"h-full rounded-full bg-gradient-to-r from-emerald-400 to-rose-500 transition-all duration-500",style:{width:s}})})]})}function f(){let{onMetricsChange:e,onEmotionStateChange:t,onSessionToggle:o}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const[f,b]=(0,s.useState)(!1),[v,g]=(0,s.useState)(!1),[w,y]=(0,s.useState)(i),[N,j]=(0,s.useState)([]),[C,A]=(0,s.useState)(null),[k,S]=(0,s.useState)(null),[_,R]=(0,s.useState)(!1),[E,P]=(0,s.useState)(null),[T,M]=(0,s.useState)("idle"),[D,I]=(0,s.useState)(null),[F,L]=(0,s.useState)(null),[O,H]=(0,s.useState)(null),q=(0,s.useRef)([]),U=(0,s.useRef)(null),W=(0,s.useRef)({counts:{},lastTimestamp:0,total:0}),V=(0,s.useRef)(null),K=(0,s.useRef)(null),z=(0,s.useRef)(null),B=(0,s.useRef)(null),$=(0,s.useMemo)(()=>"undefined"!==typeof window&&("SpeechRecognition"in window||"webkitSpeechRecognition"in window),[]),G=(0,s.useMemo)(()=>{var e,t;const r=u(null!==(e=null===w||void 0===w?void 0:w.stress)&&void 0!==e?e:0,0,1),s=u(null!==(t=null===w||void 0===w?void 0:w.confidence)&&void 0!==t?t:.5,0,1),n=function(e){if(!e)return"neutral";const t=e.toString().toLowerCase();return t.includes("jo")||t.includes("heureux")||t.includes("sour")?"joy":t.includes("calm")||t.includes("zen")?"calm":t.includes("stress")||t.includes("tendu")||t.includes("ango")||t.includes("peur")?"stress":t.includes("trist")||t.includes("fatigu")?"sad":t.includes("col\xe8r")||t.includes("anger")||t.includes("rage")?"anger":t.includes("confian")?"confident":t.includes("enthous")||t.includes("excited")?"excited":(t.includes("neutre"),"neutral")}(null===w||void 0===w?void 0:w.emotion),i=Number.isFinite(null===w||void 0===w?void 0:w.wpm)?w.wpm:null,l=null!=i?u((i-60)/80,0,1):.45,a=u(.6*l+.4*r,0,1);return{emotion:n,stressScore:r,valence:u(.5+.5*(s-r),0,1),arousal:a,confidence:s}},[w]),J=(0,s.useRef)(null),Y=(0,s.useRef)(null),X=(0,s.useRef)(null),Q=(0,s.useRef)(null),Z=(0,s.useRef)({totalWords:0,fillerCount:0,estimatedWords:0}),ee=(0,s.useRef)({wasSpeaking:!1,burstCount:0,volumeHistory:[],speakingSamples:0,totalSamples:0}),te=(0,s.useRef)({energy:null,pitch:null}),re=(0,s.useRef)(0),se=(0,s.useRef)(null),ne=(0,s.useRef)(null),ie=(0,s.useRef)(!1),le=(0,s.useCallback)(()=>{W.current={counts:{},lastTimestamp:0,total:0},U.current=null,I(null)},[]),ae=(0,s.useCallback)(async()=>{if(V.current)return V.current;if("undefined"===typeof window)return null;try{const e=await r.e(6189).then(r.bind(r,66189)),t=new((null===e||void 0===e?void 0:e.default)||(null===e||void 0===e?void 0:e.Human)||e)({cacheSensitivity:0,modelBasePath:"https://vladmandic.github.io/human/models/",face:{enabled:!0,detector:{rotation:!0,maxDetected:1},mesh:{enabled:!1},attention:{enabled:!1},description:{enabled:!1},iris:{enabled:!1},emotion:{enabled:!0}},hand:{enabled:!1},body:{enabled:!1},gesture:{enabled:!1},segmentation:{enabled:!1},filter:{enabled:!0}});return await t.load(),V.current=t,t}catch(e){return console.error("Impossible de charger Human",e),P("Impossible de charger les mod\xe8les d\u2019analyse vid\xe9o."),R(!1),M("idle"),null}},[R,M]),oe=(0,s.useCallback)(()=>{if(z.current&&(cancelAnimationFrame(z.current),z.current=null),K.current){try{K.current.pause()}catch{}K.current.srcObject=null}U.current=null,I(null),M(e=>_||"analysis"===e?"ready":"idle")},[_]),ce=(0,s.useCallback)(e=>{var t;if(!e||!e.label)return U.current=null,void I(null);const r=(e.distribution||[]).map(e=>{var t;return{label:c(e.emotion||e.label||""),score:null!==(t=e.score)&&void 0!==t?t:0}}),s={label:e.label,raw:e.raw||null,score:u(null!==(t=e.score)&&void 0!==t?t:0,0,1),distribution:r};U.current=s,I(s);const n=W.current,i="undefined"!==typeof performance?performance.now():Date.now();(!n.lastTimestamp||i-n.lastTimestamp>900)&&(n.counts[s.label]=(n.counts[s.label]||0)+1,n.total=(n.total||0)+1,n.lastTimestamp=i)},[]),ue=(0,s.useCallback)(async()=>{if(!_||!K.current)return;const e=await ae();if(!e)return;M("analysis");const t=async()=>{if(ie.current)if(!K.current||K.current.readyState<2)z.current=requestAnimationFrame(t);else{try{var r;const t=await e.detect(K.current);if(null!==t&&void 0!==t&&null!==(r=t.face)&&void 0!==r&&r.length){const e=t.face[0].emotion||[];if(e.length){const t=e.reduce((e,t)=>t.score>e.score?t:e,e[0]);ce({label:c(t.emotion||t.label),raw:t.emotion||t.label,score:t.score,distribution:e})}else ce(null)}else ce(null)}catch(s){console.error("Erreur lors de la d\xe9tection vid\xe9o",s)}z.current=requestAnimationFrame(t)}};z.current=requestAnimationFrame(t)},[ae,ce,_]),de=(0,s.useCallback)(async()=>{if(!v){if(_)return oe(),le(),R(!1),M("idle"),void P(null);if(P(null),"undefined"!==typeof navigator&&navigator.mediaDevices&&"function"===typeof navigator.mediaDevices.getUserMedia){M("checking");try{(await navigator.mediaDevices.getUserMedia({audio:!1,video:{facingMode:"user",width:{ideal:640},height:{ideal:480}}})).getTracks().forEach(e=>e.stop()),R(!0),M("ready")}catch(e){console.error(e),P("Acc\xe8s cam\xe9ra refus\xe9. V\xe9rifie les permissions de ton navigateur."),M("idle"),R(!1)}}else P("La cam\xe9ra n\u2019est pas disponible sur ce navigateur.")}},[le,v,oe,_]),me=(0,s.useCallback)(()=>{ne.current&&(ne.current.onend=null,ne.current.stop(),ne.current=null)},[]),pe=(0,s.useCallback)(()=>{ie.current=!1,X.current&&(clearInterval(X.current),X.current=null),Q.current&&(Q.current.getTracks().forEach(e=>e.stop()),Q.current=null),J.current&&(J.current.close().catch(()=>{}),J.current=null),Y.current=null,se.current=null,te.current={energy:null,pitch:null},re.current=0,L(null),H(null),oe(),me()},[me,oe]);(0,s.useEffect)(()=>()=>{pe()},[pe]),(0,s.useEffect)(()=>{if(!v||!_)return;const e=Q.current;if(!e||"function"!==typeof e.getVideoTracks)return;if(!(e.getVideoTracks().length>0))return void M("idle");const t=K.current;if(!t)return;t.srcObject!==e&&(t.srcObject=e),t.muted=!0,t.playsInline=!0;const r=t.play();r&&"function"===typeof r.catch&&r.catch(()=>{}),z.current||ue()},[v,ue,_,M]);const he=async()=>{A(null),P(null),S(null),j([]),q.current=[],y({...i}),le(),M(_?"starting":"idle"),ee.current={wasSpeaking:!1,burstCount:0,volumeHistory:[],speakingSamples:0,totalSamples:0},Z.current={totalWords:0,fillerCount:0,estimatedWords:0,fillersPerMin:null},te.current={energy:null,pitch:null},re.current=0,L(null),H(null);let e=_;if("undefined"!==typeof navigator&&navigator.mediaDevices&&"function"===typeof navigator.mediaDevices.getUserMedia)try{let r=null;try{r=await navigator.mediaDevices.getUserMedia({audio:!0,video:!!e&&{facingMode:"user",width:{ideal:640},height:{ideal:480}}})}catch(t){if(!e)throw t;console.error("Video capture unavailable, fallback to audio only",t),P("Impossible d\u2019activer la cam\xe9ra. Passage en mode vocal uniquement."),M("idle"),R(!1),e=!1,r=await navigator.mediaDevices.getUserMedia({audio:!0,video:!1})}const s=new(window.AudioContext||window.webkitAudioContext);if("suspended"===s.state)try{await s.resume()}catch{}const n=s.createAnalyser();n.fftSize=2048;s.createMediaStreamSource(r).connect(n),J.current=s,Y.current=n,Q.current=r,e&&M("starting"),se.current=performance.now(),ie.current=!0,g(!0),(()=>{if(!$)return;const e=new(window.SpeechRecognition||window.webkitSpeechRecognition);e.lang="fr-FR",e.continuous=!0,e.interimResults=!0,e.onresult=e=>{let t="";for(let r=e.resultIndex;r<e.results.length;r+=1){const s=e.results[r];s.isFinal&&(t+=s[0].transcript)}if(t){const e=t.toLowerCase().replace(/[^a-z\xe0\xe2\xe7\xe9\xe8\xea\xeb\xee\xef\xf4\xfb\xf9\xfc\xff\xf1\xe6\u0153\s]/gi," ").split(/\s+/).filter(Boolean),r=e.filter(e=>a.includes(e));Z.current.totalWords+=e.length,Z.current.fillerCount+=r.length}},e.onerror=e=>{console.warn("Speech recognition error",e.error)},e.onend=()=>{if(ie.current)try{e.start()}catch(C){console.warn("Unable to restart recognition",C)}},e.start(),ne.current=e})(),ve()}catch(r){console.error(r),A("Analyse indisponible. V\xe9rifie que le micro est bien accessible."),pe(),g(!1)}else A("Le microphone n\u2019est pas disponible sur ce navigateur.")},xe=()=>{var e;if(!Y.current)return null;const t=Y.current,r=t.fftSize,s=new Float32Array(r);t.getFloatTimeDomainData(s);let n=0;for(let u=0;u<r;u+=1)n+=s[u]*s[u];const i=Math.sqrt(n/r),l=u(i/.15,0,1),a=function(e,t){if(!e||0===e.length)return null;const r=1024,s=Math.min(1023,1023);let n=-1,i=0,l=0;for(let m=0;m<r;m+=1){const t=e[m];l+=t*t}if(l=Math.sqrt(l/r),l<.01)return null;let a=1;const o=new Array(s).fill(0);let c=!1;for(let m=2;m<s;m+=1){let l=0;for(let t=0;t<r;t+=1)l+=Math.abs(e[t]-e[t+m]);if(l=1-l/r,o[m]=l,l>.9&&l>a)c=!0,l>i&&(i=l,n=m);else if(c){var u,d;return n>1&&n<s-1?t/(n+(((null!==(u=o[n+1])&&void 0!==u?u:o[n])-(null!==(d=o[n-1])&&void 0!==d?d:o[n]))/(2*o[n])||0)):t/n}a=l}return i>.01&&n>0?t/n:null}(s,(null===(e=J.current)||void 0===e?void 0:e.sampleRate)||44100),o=ee.current;o.volumeHistory.push(l),o.volumeHistory.length>120&&o.volumeHistory.shift();const c=l>.12;c&&!o.wasSpeaking&&(o.burstCount+=1),o.wasSpeaking=c,o.speakingSamples+=c?1:0,o.totalSamples+=1;const d=o.volumeHistory.reduce((e,t)=>e+t,0)/o.volumeHistory.length,m=o.volumeHistory.reduce((e,t)=>e+(t-d)**2,0)/Math.max(1,o.volumeHistory.length-1);if(!$){const e=3.2*o.burstCount;Z.current.estimatedWords=e}return{normalizedVolume:l,variance:m,speakingRatio:o.speakingSamples/Math.max(1,o.totalSamples),pitch:a,rms:i}},fe=(0,s.useCallback)(e=>{if(!e)return{stress:.35,confidence:.55};const t=te.current;null==t.energy?(t.energy=e.rms,t.pitch=e.pitch||180):(t.energy=.98*t.energy+.02*e.rms,e.pitch&&(t.pitch=.97*t.pitch+.03*e.pitch));const r=e.rms-(t.energy||e.rms),s=e.pitch&&t.pitch?(e.pitch-t.pitch)/Math.max(1,t.pitch):0,n=e.speakingRatio,i=e.variance;let l=u(.3+6*r+.6*i+2*s,0,1),a=u(.5+.6*(n-.4)-.25*i-1.2*r,0,1);if(Number.isFinite(Z.current.fillersPerMin)){const e=Z.current.fillersPerMin;l+=u(.05*e,0,.2),a-=u(.04*e,0,.2)}return{stress:u(l,0,1),confidence:u(a,0,1)}},[]),be=(0,s.useCallback)(async e=>{if(!l||!e)return;const t=performance.now();if(!(t-re.current<5e3)){re.current=t;try{const t={rms:e.rms,variance:e.variance,speakingRatio:e.speakingRatio,pitch:e.pitch,fillersPerMin:Number.isFinite(Z.current.fillersPerMin)?Z.current.fillersPerMin:null},r=await fetch(l,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!r.ok)throw new Error(`audio_ai_${r.status}`);const s=await r.json();s&&"object"===typeof s&&(L({summary:s.summary||null,stress:"number"===typeof s.stress?u(s.stress,0,1):null,confidence:"number"===typeof s.confidence?u(s.confidence,0,1):null,source:"ai",timestamp:performance.now()}),H(null))}catch(C){console.warn("[emotion/audio] ai analysis failed",C),H("AI voice analysis unavailable, falling back to local metrics.")}}},[H,L]),ve=()=>{X.current&&clearInterval(X.current),X.current=setInterval(()=>{const e=xe();if(!se.current)return;if(!e&&!U.current)return;const t=performance.now()-se.current,r=Math.max(t/6e4,1/60),s=Z.current.totalWords||Z.current.estimatedWords||0,n=Z.current.fillerCount,i=s/r,l=n/r;Z.current.fillersPerMin=Number.isFinite(l)?l:null;const a=e||{normalizedVolume:.15,variance:.04,speakingRatio:.45,rms:.05},o=fe(a),c=u(.25+.6*a.normalizedVolume+.2*a.variance,0,1),m=u(.4+.35*a.speakingRatio-.15*a.variance+.35*(1-c),0,1),p=u(.6*o.stress+.4*c,0,1),h=u(.6*o.confidence+.4*m,0,1);be(a),y(e=>{var r,s,n;let a=d(null!==(r=e.stress)&&void 0!==r?r:.2,p,.22),o=d(null!==(s=e.confidence)&&void 0!==s?s:.6,h,.22);const c=U.current?function(e){if(null===e||void 0===e||!e.label)return null;const{label:t,score:r=.5}=e,s=u(r,.15,1),n=t.toLowerCase();let i=.5,l=.5;return["col\xe8re","stress\xe9","tendu","craintif","d\xe9go\xfbt"].some(e=>n.includes(e))?(i=.75,l=.35):["triste","perplexe","distra","somnolent"].some(e=>n.includes(e))?(i=.6,l=.3):["surpris","surprise"].some(e=>n.includes(e))?(i=.55,l=.55):["joie","joyeux","enthousias","sourire","calme","neutre"].some(e=>n.includes(e))?(i=.3,l=.72):(i=.48,l=.5),{stress:u(i*s+.5*(1-s),0,1),confidence:u(l*s+.5*(1-s),0,1)}}(U.current):null;c&&(a=d(a,c.stress,.35),o=d(o,c.confidence,.35));const m=B.current;m&&("number"===typeof m.stress&&(a=d(a,u(m.stress,0,1),.2)),"number"===typeof m.confidence&&(o=d(o,u(m.confidence,0,1),.2)));const x=(null===(n=U.current)||void 0===n?void 0:n.label)||function(e,t){return e>.75?"Stress\xe9":t>.72&&e<.55?"Confiant":e<.32&&t>=.5?"Calme":t<.35&&e>.5?"Tendu":"Concentr\xe9"}(a,o),f={emotion:x,stress:a,confidence:o,wpm:Number.isFinite(i)?i:null,fillersPerMin:Number.isFinite(l)?l:null};return j(e=>{const r=[...e,{time:t/1e3,stress:a,confidence:o,wpm:f.wpm,fillers:f.fillersPerMin}];return r.length>180&&r.shift(),q.current=r,r}),f}),L(e=>{var t,r;if("ai"===(null===e||void 0===e?void 0:e.source)&&"number"===typeof e.timestamp&&performance.now()-e.timestamp<6e3)return e;const s=Math.abs((null!==(t=null===e||void 0===e?void 0:e.stress)&&void 0!==t?t:0)-p),n=Math.abs((null!==(r=null===e||void 0===e?void 0:e.confidence)&&void 0!==r?r:0)-h);return"local"===(null===e||void 0===e?void 0:e.source)&&s<.03&&n<.03?e:{summary:(i=p,l=h,o=a.pitch,Number.isFinite(i)&&Number.isFinite(l)?i>.7&&l<.45?"Tension \xe9lev\xe9e d\xe9tect\xe9e : on ralentit et on rel\xe2che les \xe9paules avant de poursuivre.":i>.6&&l>=.45?"Beaucoup d'\xe9nergie ! Canalise-la en clarifiant ce que tu veux exprimer maintenant.":l>.7&&i<.5?"Voix stable et assur\xe9e, parfait pour d\xe9rouler ton plan.":l<.45&&i<.5?"Ton ton est calme mais h\xe9sitant : formule ta prochaine id\xe9e en une phrase forte.":o&&o>280&&i>.5?"La voix monte beaucoup, signe d'\xe9motion. Ralentis et respire pour garder la clart\xe9.":"Voix \xe9quilibr\xe9e : reste sur ce rythme et articule tes id\xe9es principales.":"Je capte ta voix, continue \xe0 parler pour une analyse compl\xe8te."),stress:p,confidence:h,source:"local",timestamp:performance.now()};var i,l,o})},750)},ge=function(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!t.length)return void S(null);const r=t.reduce((e,t)=>(e.stress+=t.stress,e.confidence+=t.confidence,Number.isFinite(t.wpm)&&(e.wpmSum+=t.wpm,e.wpmCount+=1),Number.isFinite(t.fillers)&&(e.fillers+=t.fillers,e.fillersCount+=1),e),{stress:0,confidence:0,wpmSum:0,wpmCount:0,fillers:0,fillersCount:0}),s=t.length,n={stress:r.stress/s,confidence:r.confidence/s,wpm:r.wpmCount?r.wpmSum/r.wpmCount:null,fillers:r.fillersCount?r.fillers/r.fillersCount:null},i=W.current,l=Object.entries((null===i||void 0===i?void 0:i.counts)||{}),a=null!==(e=null===i||void 0===i?void 0:i.total)&&void 0!==e?e:l.reduce((e,t)=>{let[,r]=t;return e+r},0);let o=null;if(l.length&&a>0){const e=[...l].sort((e,t)=>t[1]-e[1]);o={dominant:e[0][0],total:a,distribution:e.slice(0,4).map(e=>{let[t,r]=e;return{label:t,ratio:r/a}})}}S({averages:n,advice:p(n),history:[...t],video:o})},we=(0,s.useMemo)(()=>function(e){let{stress:t,confidence:r,fillersPerMin:s,wpm:n}=e;return t>.72||Number.isFinite(s)&&s>6?"On respire 10 secondes, rel\xe2che les \xe9paules et reprends avec un rythme pos\xe9.":r<.4&&Number.isFinite(s)&&s>=3?"Formule un objectif simple en une phrase avant de continuer. \xc7a clarifie le message.":r>.7&&t<.6&&Number.isFinite(n)&&n>=90?"Super \xe9nergie ! Propose-toi un mini-challenge de 2 minutes pour pousser un argument.":r<.45?"Prends 2 inspirations profondes et recentre ton message sur une id\xe9e ma\xeetresse.":"Maintiens ce ton clair. Garde le regard sur ton plan et avance \xe9tape par \xe9tape."}(w),[w]);return(0,s.useEffect)(()=>{B.current=F},[F]),(0,s.useEffect)(()=>{e&&e(w)},[w,e]),(0,s.useEffect)(()=>{t&&t(G)},[G,t]),(0,s.useEffect)(()=>{o&&o(v)},[v,o]),(0,n.jsx)("section",{className:"mt-16",children:(0,n.jsxs)("div",{className:"rounded-3xl border border-emerald-500/30 bg-black/70 p-8 shadow-xl shadow-emerald-500/10 backdrop-blur",children:[(0,n.jsxs)("header",{className:"space-y-2 text-white",children:[(0,n.jsx)("p",{className:"text-sm uppercase tracking-[0.3em] text-emerald-300/80",children:"ACI Meta Coach"}),(0,n.jsx)("h2",{className:"text-3xl font-bold md:text-4xl",children:"Module de d\xe9tection d\u2019\xe9motions (voix + cam\xe9ra)"}),(0,n.jsx)("p",{className:"max-w-2xl text-base text-white/70 leading-relaxed",children:"Analyse en direct de la voix pour aider le coach \xe0 adapter ses messages : \xe9motion dominante, niveau de stress, confiance, rythme de parole et h\xe9sitations. Active aussi la cam\xe9ra pour enrichir l\u2019analyse via les expressions faciales (traitement 100% local dans le navigateur)."})]}),(0,n.jsxs)("div",{className:"mt-6 flex flex-wrap items-center gap-4 text-sm text-emerald-200/90",children:[(0,n.jsx)("span",{className:"rounded-full bg-emerald-500/10 px-4 py-1",children:"Analyse vocale active pour mieux t\u2019adapter en temps r\xe9el."}),(0,n.jsxs)("button",{type:"button",onClick:de,disabled:v||"checking"===T,className:`flex items-center gap-2 rounded-full border px-3 py-1 text-white/70 transition ${_?"border-emerald-400/40 bg-emerald-500/10 text-emerald-200 hover:border-emerald-300/60":"border-white/10 hover:border-emerald-400/60 hover:text-emerald-200"} ${v?"cursor-not-allowed opacity-60":"checking"===T?"cursor-progress opacity-60":""}`,title:v?"Arr\xeate la session pour modifier l\u2019analyse vid\xe9o.":_?"D\xe9sactiver l\u2019analyse vid\xe9o":"Activer l\u2019analyse vid\xe9o",children:[(0,n.jsx)("span",{className:"inline-flex h-3 w-6 items-center rounded-full bg-white/10 px-0.5",children:(0,n.jsx)("span",{className:"h-2 w-2 rounded-full transition "+("checking"===T?"bg-amber-300":_?"bg-emerald-400":"bg-white/30")})}),"checking"===T?"Autorisation cam\xe9ra...":_?"Analyse vid\xe9o activ\xe9e":"Activer l\u2019analyse vid\xe9o"]})]}),!f&&(0,n.jsxs)("div",{className:"mt-8 rounded-2xl border border-white/10 bg-white/5 p-6 text-white",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold",children:"Consentement requis"}),(0,n.jsx)("p",{className:"mt-2 text-sm text-white/70",children:"Pour lancer la d\xe9tection d\u2019\xe9motions, autorise l\u2019acc\xe8s au microphone. Le flux audio reste local, seules les m\xe9triques calcul\xe9es sont affich\xe9es."}),(0,n.jsx)("button",{onClick:async()=>{if(A(null),"undefined"!==typeof navigator&&navigator.mediaDevices&&"function"===typeof navigator.mediaDevices.getUserMedia)try{(await navigator.mediaDevices.getUserMedia({audio:!0,video:!1})).getTracks().forEach(e=>e.stop()),b(!0)}catch(e){console.error(e),A("Impossible d\u2019acc\xe9der au microphone. V\xe9rifie les permissions de ton navigateur.")}else A("Le microphone n\u2019est pas disponible sur ce navigateur.")},className:"mt-4 inline-flex items-center justify-center rounded-full bg-emerald-500 px-6 py-2 text-sm font-semibold text-black transition hover:bg-emerald-400",children:"Autoriser l\u2019analyse vocale"}),C&&(0,n.jsx)("p",{className:"mt-3 text-sm text-rose-300",children:C})]}),f&&!v&&(0,n.jsxs)("div",{className:"mt-8 rounded-2xl border border-white/10 bg-white/5 p-6 text-white space-y-4",children:[(0,n.jsx)("p",{className:"text-sm text-white/70",children:"Tout est pr\xeat pour une session voix. Clique sur d\xe9marrer et parle comme en situation r\xe9elle. Tu peux stopper \xe0 tout moment pour consulter le bilan de fin de session."}),(0,n.jsxs)("div",{className:"flex flex-wrap items-center gap-3",children:[(0,n.jsx)("button",{onClick:he,className:"inline-flex items-center justify-center rounded-full bg-emerald-500 px-6 py-2 text-sm font-semibold text-black transition hover:bg-emerald-400",children:"Commencer une session"}),(0,n.jsx)("button",{onClick:de,disabled:"checking"===T,className:`inline-flex items-center justify-center rounded-full px-6 py-2 text-sm font-semibold transition ${_?"border border-emerald-400/40 bg-emerald-500/10 text-emerald-200 hover:border-emerald-300/60":"border border-white/20 text-white/70 hover:border-emerald-400/60 hover:text-emerald-200"} ${"checking"===T?"opacity-60 cursor-not-allowed":""}`,children:_?"ready"===T?"Cam\xe9ra pr\xeate":"Cam\xe9ra activ\xe9e":"checking"===T?"Autorisation cam\xe9ra...":"Activer la cam\xe9ra"})]}),k&&(0,n.jsx)("p",{className:"text-xs text-white/50",children:"R\xe9sultat pr\xe9c\xe9dent disponible plus bas."}),C&&(0,n.jsx)("p",{className:"mt-2 text-sm text-rose-300",children:C}),E&&(0,n.jsx)("p",{className:"text-xs text-rose-300",children:E})]}),v&&(0,n.jsxs)("div",{className:"mt-8 grid gap-8 lg:grid-cols-[1.4fr,1fr]",children:[(0,n.jsxs)("div",{className:"rounded-2xl border border-white/10 bg-white/5 p-6 text-white space-y-6",children:[(_||D)&&(0,n.jsxs)("div",{className:"relative overflow-hidden rounded-2xl border border-white/10 bg-black/60",children:[(0,n.jsx)("video",{ref:K,autoPlay:!0,muted:!0,playsInline:!0,className:"block h-full min-h-[220px] w-full object-cover"}),(0,n.jsx)("div",{className:"absolute inset-x-0 bottom-0 bg-gradient-to-t from-black/80 via-black/40 to-transparent p-4 text-sm text-white",children:null!==D&&void 0!==D&&D.label?(0,n.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,n.jsx)("span",{className:"text-base font-semibold",children:D.label}),(0,n.jsxs)("span",{className:"text-xs text-white/60",children:[(100*D.score).toFixed(0),"% confiance"]})]}):(0,n.jsx)("span",{className:"text-xs text-white/60",children:"analysis"===T?"Analyse vid\xe9o en cours...":"Cam\xe9ra pr\xeate, maintien ton visage face \xe0 l\u2019objectif."})})]}),(0,n.jsxs)("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-1 xl:grid-cols-2",children:[(0,n.jsxs)("div",{className:"rounded-2xl border border-white/10 bg-black/40 p-4",children:[(0,n.jsx)("p",{className:"text-xs uppercase text-white/50 tracking-wide",children:"\xc9motion"}),(0,n.jsx)("p",{className:"mt-2 text-2xl font-semibold text-white",children:w.emotion})]}),(0,n.jsxs)("div",{className:"rounded-2xl border border-white/10 bg-black/40 p-4",children:[(0,n.jsx)("p",{className:"text-xs uppercase text-white/50 tracking-wide",children:"Vitesse de parole"}),(0,n.jsxs)("p",{className:"mt-2 text-2xl font-semibold text-white",children:[m(w.wpm,0)," ",(0,n.jsx)("span",{className:"text-sm text-white/60",children:"mots/min"})]})]}),(0,n.jsxs)("div",{className:"rounded-2xl border border-white/10 bg-black/40 p-4",children:[(0,n.jsx)("p",{className:"text-xs uppercase text-white/50 tracking-wide",children:"\u201cEuh\u201d par minute"}),(0,n.jsx)("p",{className:"mt-2 text-2xl font-semibold text-white",children:m(w.fillersPerMin,1)})]}),(0,n.jsxs)("div",{className:"rounded-2xl border border-white/10 bg-black/40 p-4",children:[(0,n.jsx)("p",{className:"text-xs uppercase text-white/50 tracking-wide",children:"Analyse vocale IA"}),(0,n.jsx)("p",{className:"mt-2 text-sm text-white/70 leading-relaxed",children:null!==F&&void 0!==F&&F.summary?F.summary:O||"Je mesure ton ton, ton \xe9nergie et ta stabilit\xe9 pour ajuster ton coaching en direct."})]})]}),(0,n.jsx)(x,{label:"Stress",value:w.stress}),(0,n.jsx)(x,{label:"Confiance",value:w.confidence}),(0,n.jsxs)("div",{className:"rounded-2xl border border-emerald-500/30 bg-emerald-500/10 p-4 text-white",children:[(0,n.jsx)("p",{className:"text-xs uppercase text-emerald-200 tracking-wide",children:"Coach"}),(0,n.jsx)("p",{className:"mt-2 text-base leading-relaxed text-emerald-50",children:we})]})]}),(0,n.jsxs)("div",{className:"flex flex-col justify-between rounded-2xl border border-white/10 bg-white/5 p-6 text-white",children:[(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)("p",{className:"text-sm uppercase text-white/60 tracking-wide",children:"Session en cours"}),(0,n.jsx)("p",{className:"text-base text-white/70",children:"Les m\xe9triques sont mises \xe0 jour toutes les 750 ms pour garder un affichage fluide."}),E&&(0,n.jsx)("p",{className:"text-xs text-rose-300",children:E}),O&&(0,n.jsx)("p",{className:"text-xs text-amber-300",children:O})]}),(0,n.jsx)("button",{onClick:()=>function(){let{withSummary:e=!0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(g(!1),pe(),e){const e=q.current;e.length&&ge(e)}}(),className:"mt-6 inline-flex items-center justify-center rounded-full bg-rose-500 px-6 py-2 text-sm font-semibold text-black transition hover:bg-rose-400",children:"Arr\xeater et afficher le bilan"})]})]}),k&&(0,n.jsxs)("div",{className:"mt-10 rounded-3xl border border-white/10 bg-white/5 p-6 text-white space-y-6",children:[(0,n.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[(0,n.jsx)("h3",{className:"text-2xl font-semibold",children:"Bilan de la session"}),(0,n.jsxs)("span",{className:"text-sm text-white/60",children:["Stress (rose) \u2022 Confiance (vert) sur ",k.history.length," points"]})]}),(0,n.jsx)(h,{history:k.history}),(0,n.jsxs)("div",{className:"grid gap-4 sm:grid-cols-3",children:[(0,n.jsxs)("div",{className:"rounded-2xl border border-white/10 bg-black/40 p-4",children:[(0,n.jsx)("p",{className:"text-xs uppercase text-white/50 tracking-wide",children:"Stress moyen"}),(0,n.jsxs)("p",{className:"mt-2 text-xl font-semibold text-white",children:[m(100*k.averages.stress,0),"%"]})]}),(0,n.jsxs)("div",{className:"rounded-2xl border border-white/10 bg-black/40 p-4",children:[(0,n.jsx)("p",{className:"text-xs uppercase text-white/50 tracking-wide",children:"Confiance moyenne"}),(0,n.jsxs)("p",{className:"mt-2 text-xl font-semibold text-white",children:[m(100*k.averages.confidence,0),"%"]})]}),(0,n.jsxs)("div",{className:"rounded-2xl border border-white/10 bg-black/40 p-4",children:[(0,n.jsx)("p",{className:"text-xs uppercase text-white/50 tracking-wide",children:"Rythme global"}),(0,n.jsxs)("p",{className:"mt-2 text-xl font-semibold text-white",children:[m(k.averages.wpm,0)," mots/min"]})]}),(0,n.jsxs)("div",{className:"rounded-2xl border border-white/10 bg-black/40 p-4 sm:col-span-3",children:[(0,n.jsx)("p",{className:"text-xs uppercase text-white/50 tracking-wide",children:"\u201cEuh\u201d moyen"}),(0,n.jsxs)("p",{className:"mt-2 text-xl font-semibold text-white",children:[m(k.averages.fillers,1)," par minute"]})]}),k.video&&(0,n.jsxs)("div",{className:"rounded-2xl border border-white/10 bg-black/40 p-4 sm:col-span-3",children:[(0,n.jsx)("p",{className:"text-xs uppercase text-white/50 tracking-wide",children:"\xc9motions visuelles d\xe9tect\xe9es"}),(0,n.jsxs)("div",{className:"mt-2 flex flex-wrap items-center gap-3 text-sm text-white/80",children:[(0,n.jsxs)("span",{className:"rounded-full bg-white/10 px-3 py-1",children:["Dominante : ",k.video.dominant]}),k.video.distribution.map(e=>(0,n.jsxs)("span",{className:"rounded-full border border-white/10 px-3 py-1",children:[e.label," \xb7 ",m(100*e.ratio,0),"%"]},e.label))]})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-sm uppercase text-white/60 tracking-wide",children:"3 conseils pour la prochaine fois"}),(0,n.jsx)("ul",{className:"mt-3 space-y-2 text-sm text-white/80",children:k.advice.map((e,t)=>(0,n.jsx)("li",{className:"rounded-2xl border border-white/10 bg-black/40 p-3",children:e},t))})]}),(0,n.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[(0,n.jsx)("button",{onClick:he,className:"inline-flex items-center justify-center rounded-full bg-emerald-500 px-6 py-2 text-sm font-semibold text-black transition hover:bg-emerald-400",children:"Relancer une session"}),(0,n.jsx)("p",{className:"text-xs text-white/50",children:"Les donn\xe9es restent c\xf4t\xe9 navigateur. Relance la d\xe9tection quand tu veux."})]})]})]})})}}}]);